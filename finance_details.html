<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<title>AdminLTE 2 | finance</title>
		<meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
		<link rel="stylesheet" href="bower_components/bootstrap/dist/css/bootstrap.min.css">
		<link rel="stylesheet" href="bower_components/font-awesome/css/font-awesome.min.css">
		<link rel="stylesheet" href="bower_components/Ionicons/css/ionicons.min.css">
		<link rel="stylesheet" href="dist/css/AdminLTE.min.css">
		<link rel="stylesheet" href="dist/css/skins/skin-blue.min.css">
		<link rel="stylesheet" href="css/fr_card.css">
		<link rel="stylesheet" href="css/fr_style.css">
		<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600,700,300italic,400italic,600italic">
		<link rel="stylesheet" href="bower_components/datatables.net-bs/css/dataTables.bootstrap.min.css">
		<link rel="stylesheet" href="bower_components/bootstrap-datepicker/dist/css/bootstrap-datepicker.min.css">
	</head>

	<body class="hold-transition skin-blue sidebar-mini">
		<div class="wrapper">
			<div class="content-wrapper">
				<section class="content-header ">
					<ol class="breadcrumb">
						<li>
							<a href="#"><i class="fa fa-dashboard"></i>财务管理</a>
						</li>
						<li class="active">收支明细</li>
					</ol>
				</section>
				<section class="content">
					<div class="box box-primary">
						<div class="box-header with-border">
							<div class="">
								<div class="inline-block">
									<span>时间：</span>
									<input type="text" class="form-control time" id="startTime" />
									-
									<input type="text" class="form-control time" id="endTime" />
								</div>
								<div class="inline-block">
									<select name="" id="type">
										<option value="">全部类型</option>
										<option value="1">激活</option>
										<option value="2">充值</option>
										<option value="3">提现</option>
										<option value="4">收益</option>
										<option value="5">转出</option>
										<option value="6">提现手续费</option>
										<option value="7">转账手续费</option>
										<option value="8">订单扣费</option>
										<option value="9">转入</option>
										<option value="10">收益转信用点</option>
										<option value="11">提现失败返还</option>
										<option value="12">转账失败返还</option>
										<option value="13">订单取消返还</option>
									</select>
								</div>
								<div class="inline-block">
									<span>账号：</span>
									<input type="text" placeholder="" id="phone"/>
								</div>
								<div class="inline-block">
									<button type="button" class="btn btn-block btn-info" id="search">搜索</button>
								</div>
							</div>
							<!-- /.box-tools -->
						</div>
						<div class="about_card">
							<div class="details_card">
								<div class="box-body">
									<div class="box_body_card list list5" style="background-color: #E7F4FF;border-radius:5px;">
										<ul id="countData">
											<li>
												<div class="card_title">
													<span>充值收入</span>
												</div>
												<div class="card_content">
													<span name="rechargeMoney">--</span>
												</div>
											</li>
											<li>
												<div class="card_title">
													<span>订单收入</span>
												</div>
												<div class="card_content">
													<span name="incomeMoney">--</span>
												</div>
											</li>
											<li>
												<div class="card_title">
													<span>激活收入</span>
												</div>
												<div class="card_content">
													<span name="activeMoney">--</span>
												</div>
											</li>
											<li>
												<div class="card_title">
													<span>利润</span>
												</div>
												<div class="card_content">
													<span name="profitMoney">--</span>
												</div>
											</li>
										</ul>
									</div>
									<table id="example" class="table table-bordered table-hover picTable">
										<!--<thead>-->
										<thead>
											<tr>
												<th>订单号</th>
												<th>订单时间</th>
												<th>账号</th>
												<th>类型</th>
												<th>所属ID</th>
												<th>金额</th>
												<th>账户金额</th>
											</tr>
										</thead>
										<!--</thead>-->
										<tbody>
											
										</tbody>
									</table>
								</div>
							</div>
						</div>
					</div>
				</section>
			</div>
		</div>
		<script src="bower_components/jquery/dist/jquery.min.js"></script>
		<script src="bower_components/bootstrap/dist/js/bootstrap.min.js"></script>
		<script src="dist/js/adminlte.min.js"></script>

		<script src="bower_components/datatables.net/js/jquery.dataTables.min.js"></script>
		<script src="bower_components/datatables.net-bs/js/dataTables.bootstrap.min.js"></script>
		<script src="bower_components/bootstrap-datepicker/dist/js/bootstrap-datepicker.min.js"></script>

		<!--<script src="bower_components/bootstrap-datepicker/dist/js/bootstrap-datepicker.min.js"></script>-->
		<script src="plugins/timepicker/bootstrap-timepicker.min.js"></script>
		<script src="bower_components/moment/min/moment.min.js"></script>
		<script src="bower_components/bootstrap-datepicker/dist/js/bootstrap-datepicker.min.js"></script>
		
		
		<script src="js/fr_func.js"></script>
		<script src="js/fr.js"></script>
		<script src="js/nav.js"></script>
		<script type="text/javascript">
			function financial_details_Type(type) {
				var str = "";
				if(type == 1) {
					str = "激活"
				} else if(type == 2) {
					 str = "充值"
				} else if(type == 3) {
					 str = "提现"
				} else if(type == 4) {
					 str = "收益"
				} else if(type == 5) {
					 str = "转出"
				} else if(type == 6) {
					 str = "提现手续费"
				} else if(type == 7) {
					 str = "转账手续费"
				} else if(type == 8) {
					 str = "订单扣费"
				} else if(type == 9) {
					 str = "转入"
				} else if(type == 10) {
					 str = "收益转信用点"
				} else if(type == 11) {
					 str = "提现失败返还"
				} else if(type == 12) {
					 str = "转账失败返还"
				} else if(type == 13) {
					 str = "订单取消返还"
				}
					return str;
			}
			function financial_details_Money(type,num){
				var str = "";
				if(type==2||type==4||type==9||type==10||type == 11||type == 12) {
					str = '<span class="text-green">+' + num + '</span>';
				} else {
					str = '<span class="text-red">-' +  num + '</span>';
				}
				return str;
			}
			$(function() {
				$('#startTime').datepicker({
					autoclose: true,
					format: 'yyyy-mm-dd',
				})
				$('#endTime').datepicker({
					autoclose: true,
					format: 'yyyy-mm-dd',
				})
				
				
				var table = $('#example').DataTable({
					'ordering': false,
					'lengthChange': false,
					'searching': false,
					'info': true,
					"processing": true,
					"serverSide": true,
					"ajax": {
						"type": 'post',
						"url": url + '/financial/IODetails',
						"contentType": "application/json",
						"data": function(d) {
							var data = {
								startTime:$("#startTime").val(),
								endTime:$("#endTime").val(),
								curPage: d.start / 10 + 1,
								pageSize: d.length,
								phone: $('#phone').val(),
								type:$("#type").val(),
								token: localStorage.getItem('fr_token'),
							}
							return JSON.stringify(data)
						},
						"dataFilter": function(data) {
							var datajson = eval('(' + data + ')')
							//						reLogin(datajson.returnCode)
							if(datajson.returnCode == 501) {
								ToLogin(datajson)
							} else if(datajson.returnCode == 500) {
								alert(datajson.msg)
								return false;
							}
							$.each(datajson.data.countData,function(index,item){
								console.log(datajson.data.countData)
								$("#countData [name="+index+"]").text(item);
							})
							
							var json = {};
							json.recordsTotal = datajson.data.totalCount;
							json.recordsFiltered = datajson.data.totalCount;
							json.data = datajson.data.data;
							return JSON.stringify(json);
						}
					},
					"columns": [
						{data: 'id'},
						{data: 'time'},
						{data: 'phone'},
						{data: null,render:function(data){
							return financial_details_Type(data.type);
						}},
						{data: 'userId'},
						{data: null,render:function(data){
							return financial_details_Money(data.type,data.money);
						}},
						{data: "accountMoney"}
					]
				})
				
				$("#search").click(function(){
					table.ajax.reload();
				})
			})
		</script>
	</body>

</html>